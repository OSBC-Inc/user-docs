# RCE Vulnerability

워크숍 동안 우리는 최상위 Docker 이미지 취약성에 [주의를 기울이고](../module-1-scanning-and-monitoring-source-code/review-application-scan-results.md) 기본 이미지를 업그레이드할 수 있는 방법을 설명합니다. 취약점을 검토하고 Tomcat 버전에 대한 스크린샷을 포함했습니다. 이 섹션에서는 리포지토리에 있는 Tomcat 버전을 활용합니다.

[README.md](https://github.com/snyk-labs/java-goof/blob/master/exploits/tomcat-rce/README.md) 내용은 수행할 작업에 대해 상당히 포괄적입니다. 여기서 통일된 이야기는 외부 사용자가 타사 소프트웨어 사용을 기반으로 애플리케이션의 취약성을 악용할 수 있는 방법입니다. 이 경우 애플리케이션 서버 Tomcat입니다.

The exploit sets up a webform where you can run commands. Some of these commands include `whoami` and `dpkg -l` but may also include other commands that echo the contents of `/etc/passwd` or `touch`. When we run the workshop, we'll showcase a number of interesting commands including:

익스플로잇은 명령을 실행할 수 있는 웹 양식을 설정합니다. 이러한 명령 중 일부에는 `whoami` 및 `dpkg -l`이 포함되지만 `/etc/passwd` 또는 `touch`의 내용을 에코하는 다른 명령도 포함될 수 있습니다. 워크숍을 진행하면 다음과 같은 여러 가지 흥미로운 명령을 선보일 것입니다.

* `cat etc/passwd`
* `touch <filename>`
* `touch /etc/testfile`
* `curl`

이러한 명령은 공격자가 취약한 시스템에서 사용할 수 있는 항목을 탐색하는 데 사용할 수 있는 대표적인 명령입니다. 그들은 ssh를 사용하여 시스템에 액세스하지 않고 시스템을 악용하기 위해 쉘 명령을 실행하는 방법을 찾습니다. 이 취약한 시스템에서 사용할 수 있는 기능을 익히기 위해 다양한 명령을 시도하는 것이 좋습니다.

명령을 실행하여 시스템을 패치하고 다시 확인하면 취약점이 더 이상 존재하지 않는 것을 볼 수 있습니다. CLI에서 명령을 실행하는 동안 `tomcat-rce.sh` 파일의 내용은 다음과 같습니다:

```
#!/usr/bin/env bash

HOSTIP="$(ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1' | head -1):8080"

LB_HOST=$(kubectl get svc goof -o json | jq -r .status.loadBalancer.ingress[0].hostname)
if [[ "$LB_HOST" != "" ]]; then
    HOSTIP=$LB_HOST
fi

echo Detected $HOSTIP as target host
docker build -t tomcat-rce tomcat-rce
alias check="docker run --rm -it tomcat-rce -u http://${HOSTIP}"
alias pwn="docker run --rm -it tomcat-rce -u http://${HOSTIP} -p pwn"
alias bounce="kubectl delete pod --selector app=goof"
alias browse="open http://${HOSTIP}"
```

다양한 URL 명령이 무엇이고 어떻게 작동하는지 궁금할 수 있습니다. 여기에서 Dockerfile을 검토하여 우리가 고의적으로 취약한 컨테이너를 만들고 있고 우리를 대신하여 작업을 수행하기 위해 매개 변수를 수락하고 있는지 확인하는 것이 좋습니다. 컨테이너에 대한 액세스 권한을 부여하기 위해 파일을 업로드했기 때문입니다. 이는 [CVE-2017-12617](https://security.snyk.io/vuln/SNYK-JAVA-ORGAPACHETOMCAT-451514)이 임의 코드 실행 취약점이고 실행을 위해 임의 코드를 전송하기 때문입니다!

이 취약점에 대한 해결책은 최신 버전의 tomcat을 사용하는 것입니다. 최신 버전을 사용하도록 Dockerfile을 패치하면 취약점이 사라집니다.
